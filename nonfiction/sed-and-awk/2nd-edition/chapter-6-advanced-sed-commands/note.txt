11/23/2024

Three Groupings of commands
        Working with a multiline pattern space (N,D,P)

        Using the hold space to perseve the contents of the
        pattern space and make it available
        for subsequent comamnds (H,h,G,g,x)

        Writing scripts that use branching and conditional instructions
        to change the flow of control(:,b,t)

All advanced scripts in this chapter alter the sequential flow
of execution ro control. They interrupt of break the normal
flow of control for various reason

Powerful, but makes the scripts much harder to understand

Multiline Pattern Space
        Pattern matching is line-oriented
                Grep matches patterns on a single line of input

                Makes it difficult to match a phrase, for instance, which can
                start at the end of one line and finish at the
                beginning of the next line

                Other patterns might be significant only when repeated
                on multiple lines

        Sed has the ability to look at more than one line in the pattern
        space. This allows you to match patterns that extend over multiple
        lines

        The three multiline commands (N,D,P) correspond to their lowercase
        basic commands (n,d,p)

        Append Next Line
                Multiline Next (N) command

                Creates a multiline pattern space by reading a
                new line of input and appending it to the contents
                of the pattern space

                        The original contents of pattern space and the new input
                        line are separated by a newline. The embedded newline
                        character can be matched in patterns by the escape
                        sequence "\n".

                        "^" matches the very first character of the pattern space,
                        and not the character(s) following any embedded newline(s).

                        "$" matches only the final newline in the pattern space, and
                        not any embedded newline(s)

                After the command is executed, control is then passed to subsequent
                commands in the script

                Differs from next(n) command
                        Outputs contents of pattern
                        space and then reads a new line
                        of input

                        vs appending and creating a multiline
                        pattern space

                Ex: Change "Owner and Operator Guide" when its on two lines
                        Consult Section 3.1 in the Owner and Operator
                        Guide for a description of the tape drives
                        available on your system

                        /Operator$/{
                                N
                                s/Owner and Operator\nGuide/Installation Guide\
                                /
                        }

                        Adds a newline to get this
                                Consult Section 3.1 in the Installation Guide
                                for a description of the tape drives
                                available on your system

                        If the newline wasn't there, it would combine the two
                        lines into one

                What if there are other occurrences of "Owner and Operator Guide"
                that break over multiple lines in differnet places?

                Ex:
                        s/Owner and Operator Guide/Installation Guide/
                        /Owner/{
                                N
                                s/ *\n/ /
                                s/Owner and Operator Guide */Installation Guide\
                                /
                        }

                        First line matches it when it appears on a line by itself

                        If we match the string "Owner", the next line is read into
                        pattern space, and repalce the embedded newline with a space.
                        Then we attempt to match the whole pattern and make the replacement
                        followed by a newline

                        Example output:
                                Consult Section 3.1 in the Installation Guide
                                for a description of the tape drives
                                available on your system.

                                Look in the Installation Guide shipped with your system.

                                Two manuals are provided including the Installation Guide
                                and the User Guide.

                                The Installation Guide is shipped with your system.

                        It seems redundant to have two subsitute commands but there is
                        a reason. Lets remove the first substitute
                                Consult Section 3.1 in the Installation Guide
                                for a description of the tape drives
                                available on your system.

                                Look in the Installation Guide
                                shipped with your system.
                                Two manuals are provided including the Installation Guide
                                and the User Guide.
                
                        Two problems
                                Last line did not print
                                        The last line matches "Owner" and when N  is executed, there
                                        is not another input line to read, so sed quits
                                        immediatly without outputting the line

                                        Fix:
                                                $!N
                                                        Excludes the last line from Next

                                Occurrence of "Owner and Operator Guide" in the second paragraph
                                        Its found on a line itself in the file
                                                Look in the Owner and Operator Guide shipped with your system

                                        In the output the blank line following "shipped with your system" is missing

                                        The line matches "Owner" and the next line, a blank line, is appended to the
                                        pattern space. The subsittue command removes the embedded newline and the blank line
                                        vanishes

                                        The best solution is to avoid rading the next line when the pattern
                                        can be matched on one line

        Multiline Delete
                delete command (d) deletes the contents of the pattern space
                and causes a new line of input to be read with editing resuming at the top of the script
